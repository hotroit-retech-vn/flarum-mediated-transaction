(()=>{var t={n:n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},d:(n,e)=>{for(var r in e)t.o(e,r)&&!t.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:e[r]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n)};(()=>{"use strict";const n=flarum.core.compat["common/app"];t.n(n)().initializers.add("retechvn/mediated-transaction",(function(){console.log("[retechvn/mediated-transaction] Hello, forum and admin!")}));const e=flarum.core.compat["forum/app"];var r=t.n(e);const a=flarum.core.compat["components/LinkButton"];var i=t.n(a);const s=flarum.core.compat["common/extend"],o=flarum.core.compat["components/IndexPage"];var c=t.n(o);function u(t,n){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},u(t,n)}function l(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,u(t,n)}const d=flarum.core.compat["common/components/Page"];var h=t.n(d);const v=flarum.core.compat["helpers/listItems"];var p=t.n(v);const _=flarum.core.compat["components/Button"];var f=t.n(_);const g=flarum.core.compat["common/components/Alert"];var b=t.n(g);const y=flarum.core.compat["components/Modal"];var N=t.n(y);const C=flarum.core.compat.app;var k=t.n(C),w=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n)},e.title=function(){return"Thanh Toán Giao Dịch"},e.content=function(){return m(".Modal-body .row",[m(".Form-group",{style:"width: 100%; text-align: center;"},[m("a",{href:"https://me-qr.com",style:"cursor:pointer;display:block",border:"0"},[m("img",{src:"https://cdn2.me-qr.com/qr/129980334.png?v=1728835376",alt:"Create QR code for free"})])]),m(".Form-group ",{style:"width: 100%;"},[f().component({type:"submit",className:"Button Button--primary Button--block"},"Tiếp tục tạo giao dịch")])])},e.onsubmit=function(t){t.preventDefault(),this.attrs.onsubmit(!0),k().modal.close()},n}(N()),T=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.loading=!0,this.user_current=r().session.user,this.initializeData(),this.resultsUser=[],this.showDropdown=!1,this.handleClickOutside=this.handleClickOutside.bind(this)},e.initializeData=function(){this.data={rvn_creator_id:this.user_current.data.id,rvn_receiver_id:"",rvn_amount:0,rvn_fee:.1,rvn_payer_id:this.user_current.data.id,rvn_note:""},this.rvn_creator_name=r().session.user.username(),this.rvn_receiver_name="",this.rvn_service_fee=0,this.rvn_total_amount=0,this.rvn_receiver_name_search="",this.rvn_receiver_name_select=""},e.oncreate=function(n){t.prototype.oncreate.call(this,n),r().setTitle("Giao dịch trung gian"),r().setTitleCount(0),document.addEventListener("click",this.handleClickOutside)},e.onremove=function(){document.removeEventListener("click",this.handleClickOutside)},e.view=function(){return m(".IndexPage",[c().prototype.hero(),m(".container",[m(".sideNavContainer",[this.renderSidebar(),this.renderForm()])])])},e.renderSidebar=function(){return m("nav.IndexPage-nav.sideNav",m("ul",p()(c().prototype.sidebarItems().toArray())))},e.renderForm=function(){var t=this;return m(".IndexPage-results.sideNavOffset",[m("div.retechvn__text-center",m("h2","Giao dịch trung gian")),m(".Modal-body.rvn__body-form .row",[this.renderInput("Tên đồ án","Nhập tên đồ án",this.rvn_creator_name+(""!=this.rvn_receiver_name?"__"+this.rvn_receiver_name:""),!0),this.renderReceiverInput("Tên đối tác","Nhập tên đối tác cần tìm kiếm"),this.renderNumberInput("Tiền thuê",this.data.rvn_amount,this.handleRentChange.bind(this)),this.renderInput("Phí dịch vụ ("+100*this.data.rvn_fee+"%)","",this.rvn_service_fee,!0),this.renderRadioGroup("Người trả phí","Bạn trả phí","Đối tác trả phi"),this.renderInput("Tổng tiền bạn phải trả","",this.rvn_total_amount,!0),this.renderTextarea("Ghi chú",this.data.rvn_note,(function(n){return t.data.rvn_note=n.target.value})),this.renderCheckbox(),this.renderSubmitButton()])])},e.renderInput=function(t,n,e,r){return void 0===r&&(r=!1),m(".Form-group.col.col-md-6",[m("label",t),m("input.FormControl",{value:e,disabled:r,placeholder:n})])},e.renderReceiverInput=function(t,n){var e=this;return m(".Form-group.position-relative.col.col-md-6",[m("label",[t,m("span",{className:this.data.rvn_receiver_id?"rvn__text-green":"rvn__text-red"},this.data.rvn_receiver_id?" ("+this.rvn_receiver_name_select+")":" (Chưa chọn)")]),m("input.FormControl",{value:this.rvn_receiver_name_search,placeholder:n,onfocus:function(){return e.showDropdown=!0},onkeyup:function(t){e.rvn_receiver_name_search=t.target.value,setTimeout((function(){return e.search(t.target.value)}),100)}}),this.showDropdown&&this.renderDropdown()])},e.renderDropdown=function(){return m(".search-results",this.resultsUser.length?this.resultsUser.map(this.renderDropdownItem.bind(this)):m("div.no-results.rvn__mx2","Không có dữ liệu"))},e.renderDropdownItem=function(t){var n=this;return m("div.search-result-item",{onclick:function(){return n.selectReceiver(t)}},[t.avatarUrl()?m("img.Avatar.rvn__avatar",{src:t.avatarUrl(),alt:t.displayName()}):m("span.Avatar.rvn__avatar",{style:this.avatarStyle(t)},t.displayName().charAt(0).toUpperCase()),m("span.username","  "+t.displayName()+" ("+t.username()+")")])},e.renderNumberInput=function(t,n,e){return m(".Form-group.col.col-md-6",[m("label",t+" ("+this.formatCurrency(n)+")"),m("input[type=number].FormControl",{value:n,onchange:e})])},e.renderRadioGroup=function(t,n,e){return m(".Form-group.col.col-md-6",[m("label",t),m(".radio-group",[this.renderRadioOption(n,this.data.rvn_creator_id,this.rvn_creator_name,this.data.rvn_payer_id==this.data.rvn_creator_id),this.renderRadioOption(e,this.data.rvn_receiver_id,this.rvn_receiver_name,this.data.rvn_payer_id==this.data.rvn_receiver_id,!this.data.rvn_receiver_id)])])},e.renderRadioOption=function(t,n,e,r,a){var i=this;return void 0===a&&(a=!1),m("label",[m("input[type=radio]",{name:"fee_payer",value:n,checked:r,disabled:a,onchange:function(t){return i.handleFeePayerChange(t)}})," "+t+" ("+e+")"])},e.renderTextarea=function(t,n,e){return m(".Form-group.col.col-12.rvn_note",[m("label",t),m("textarea.FormControl",{value:n,onchange:e})])},e.renderCheckbox=function(){var t=this;return m(".Form-group.col",[m("label",[m("input[type=checkbox]",{checked:this.isChecked,onchange:function(n){return t.isChecked=n.target.checked}})," Đồng ý với điều khoản và điều kiện!"])])},e.renderSubmitButton=function(){var t=this;return m(".Form-group.col.col-12",[f().component({type:"button",className:"Button Button--primary Button--block",onclick:function(n){return t.onsubmit(n)}},"Tạo giao dịch")])},e.handleRentChange=function(t){this.data.rvn_amount=+t.target.value,this.calculateTotal()},e.handleFeePayerChange=function(t){this.data.rvn_payer_id=t.target.value,this.calculateTotal()},e.selectReceiver=function(t){this.rvn_receiver_name=t.username(),this.rvn_receiver_name_search="",this.rvn_receiver_name_select=t.displayName()+" ("+t.username()+")",this.data.rvn_receiver_id=t.data.id,this.showDropdown=!1},e.avatarStyle=function(t){return{"--avatar-bg":t.color(),"font-size":"20px"}},e.validateForm=function(){for(var t=this.data,n=0,e=[[!t.rvn_receiver_id,"Chưa chọn tên đối tác."],[t.rvn_amount<=0,"Tiền thuê phải lớn hơn 0."],[!t.rvn_fee,"Phí dịch vụ không hợp lệ."],[!t.rvn_payer_id,"Người trả phí chưa được chọn."],[!this.isChecked,"Bạn phải đồng ý với điều khoản và điều kiện."]];n<e.length;n++){var r=e[n],a=r[0],i=r[1];if(a)return this.showAlert("error",i,5e3),!1}return!0},e.formatCurrency=function(t){return(+t).toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0,maximumFractionDigits:0})},e.calculateTotal=function(){var t=+this.data.rvn_amount||0,n=.1*t;this.rvn_service_fee=this.formatCurrency(n),this.rvn_total_amount=this.formatCurrency(this.data.rvn_payer_id==this.data.rvn_creator_id?t+n:t)},e.search=function(t){var n=this;t.trim()?r().store.find("users",{filter:{q:t}}).then((function(t){n.resultsUser=t.filter((function(t){return t.data.id!=n.user_current.id()})),n.showDropdown=!0})):(this.resultsUser=[],this.showDropdown=!1)},e.handleClickOutside=function(t){t.target.closest(".FormControl")||t.target.closest(".search-results")||(this.showDropdown=!1,m.redraw())},e.showAlert=function(t,n,e){void 0===t&&(t="success"),void 0===n&&(n=""),void 0===e&&(e=5e3),r().alerts.show(b(),{type:t},n),setTimeout((function(){r().alerts.clear()}),e)},e.onsubmit=function(t){var n=this;t.preventDefault(),this.loading=!0;var e={rvn_creator_id:Number(this.data.rvn_creator_id),rvn_receiver_id:Number(this.data.rvn_receiver_id),rvn_amount:Number(this.data.rvn_amount),rvn_fee:this.data.rvn_fee,rvn_payer_id:Number(this.data.rvn_payer_id),rvn_note:this.data.rvn_note};r().modal.show(w,{onsubmit:function(t){r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/transactions",body:{data:e}}).then((function(t){n.showAlert("success","Tạo giao dịch thành công!",5e3),n.initializeData(),n.loading=!1})).catch((function(t){console.log(t),n.showAlert("error","Có lỗi xảy ra. Vui lòng thử lại!",5e3),n.loading=!1}))}})},n}(h());const x=flarum.core.compat["forum/components/HeaderSecondary"];var I=t.n(x);const F=flarum.core.compat["components/UserPage"];var R=t.n(F);function B(){return B=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)({}).hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},B.apply(null,arguments)}const D=flarum.core.compat.Component;var A=t.n(D);const P=flarum.core.compat["components/LoadingIndicator"];var S=t.n(P);const U=flarum.core.compat["common/components/Dropdown"];var O=t.n(U),H=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.transId=this.attrs.transId,this.currentUserId=this.attrs.userId,this.loading=!0,this.moreResults=!1,this.tranlogs=[],this.loadData(this.transId)},e.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.tranlogs,t.payload.data),this.loading=!1,m.redraw(),t},e.loadData=function(t,n){void 0===n&&(n=0),k().store.find("transaction-logs",{filter:{transactionId:t},page:{offset:n}}).catch((function(){})).then(this.parseResults.bind(this))},e.title=function(){return"Chi tiết giao dịch"},e.content=function(){var t=this;return this.loading?m("div",{className:"Modal-body"},S().component({size:"large"})):m("div",{className:"Modal-body sideNavContainer"},m("table",{className:"TransactionLogsTable rvn__table"},m("thead",{class:"rvn__thead"},m("tr",{class:"rvn__tr"},m("th",{class:"rvn__th"},"STT"),m("th",{class:"rvn__th"},"Trạng thái"),m("th",{class:"rvn__th"},"Lý do"),m("th",{class:"rvn__th"},"Ngày cập nhật"))),m("tbody",{class:"rvn__tbody"},this.tranlogs.length?this.tranlogs.map((function(n,e){return m("tr",{key:n.id,class:"rvn__tr"},m("td",{class:"rvn__th"},e+1),m("td",{class:"rvn__th"},t.showText(t.currentUserId,n.attributes.creator,n.attributes.rvn_status,n.attributes.transaction)),m("td",{class:"rvn__th"},n.attributes.rvn_reason||"N/A"),m("td",{class:"rvn__th"},n.attributes.updated_at))})):m("tr",null,m("td",{class:"rvn__th",colSpan:"6"},"Không có dữ liệu")))))},e.showText=function(t,n,e,r){var a="";return 1==e&&(a="["+n.username+"] đã tạo giao dịch"),2==e&&(a="["+n.username+"] đã thanh toán giao dịch"),3==e&&(a="["+n.username+"] đã hoàn thành giao dịch"),4==e&&(a="["+n.username+"] đã hủy giao dịch"),5==e&&(a="["+n.username+"] đã khiếu nại giao dịch"),a},e.onsubmit=function(t){t.preventDefault()},e.className=function(){return"DetailTransactionModal"},n}(N()),M=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.transId=this.attrs.transId,this.currentUserId=this.attrs.userId,this.reason="",this.loading=!1,this.status=this.attrs.status,this.status_old=this.attrs.status_old,this.onCancelConfirmed=this.attrs.onCancelConfirmed||function(){}},e.titleStatus=function(t){switch(t){case 3:return"Xác nhận hoàn thành giao dịch";case 4:return"Xác nhận hủy giao dịch";case 5:return"Xác nhận khiếu nại giao dịch";default:this.hide()}},e.title=function(){return this.titleStatus(this.status)},e.content=function(){var t=this;return m("div",{className:"Modal-body"},3!==this.status?m("div",{className:"Form-group"},m("label",null,"Lý do"),m("input",{className:"FormControl",type:"text",placeholder:"Nhập lý do",value:this.reason,oninput:function(n){t.reason=n.target.value}})):"",m("div",{className:"Form-group"},m(f(),{className:"Button Button--primary",type:"submit",loading:this.loading},"Xác nhận"),m(f(),{className:"Button Button--secondary",onclick:function(){t.onCancelConfirmed(),t.hide()}},"Hủy bỏ")))},e.onsubmit=function(t){var n=this;t.preventDefault(),this.loading=!0;var e={transId:Number(this.transId),userId:Number(this.currentUserId),reason:this.reason,status:this.status,status_old:this.status_old};k().request({method:"POST",url:k().forum.attribute("apiUrl")+"/transaction-logs",body:{data:e}}).then((function(t){n.loading=!1,n.onCancelConfirmed(),n.hide(),k().alerts.show({type:"success"},"Đã cập nhật.")})).catch((function(t){n.loading=!1,k().alerts.show({type:"error"},"Đã xảy ra lỗi. Vui lòng thử lại.")}))},e.className=function(){return"CancelTransactionModal"},n}(N()),L=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.bankAccountName="",this.bankAccountNumber="",this.bankName="",this.totalAmount=5e5},e.title=function(){return"Yêu cầu rút tiền"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form-group"},m("label",null,"Tổng số tiền có thể rút"),m("input",{className:"FormControl",type:"text",value:this.totalAmount,disabled:!0})),m("div",{className:"Form-group"},m("label",null,"Tên tài khoản ngân hàng"),m("input",{className:"FormControl",type:"text",placeholder:"Nhập tên tài khoản ngân hàng",value:this.bankAccountName,oninput:function(n){t.bankAccountName=n.target.value}})),m("div",{className:"Form-group"},m("label",null,"Số tài khoản ngân hàng"),m("input",{className:"FormControl",type:"text",placeholder:"Nhập số tài khoản ngân hàng",value:this.bankAccountNumber,oninput:function(n){t.bankAccountNumber=n.target.value}})),m("div",{className:"Form-group"},m("label",null,"Tên ngân hàng"),m("input",{className:"FormControl",type:"text",placeholder:"Nhập tên ngân hàng",value:this.bankName,oninput:function(n){t.bankName=n.target.value}})),m("div",{className:"Form-group"},m(f(),{className:"Button Button--primary",type:"submit",loading:this.loading,onclick:function(){t.onSubmit()}},"Xác nhận"),m(f(),{className:"Button Button--secondary",onclick:function(){t.onCancelConfirmed(),t.hide()}},"Hủy bỏ")))},e.showAlert=function(t,n,e){void 0===t&&(t="success"),void 0===n&&(n=""),void 0===e&&(e=5e3),k().alerts.show(Alert,{type:t},n),setTimeout((function(){k().alerts.clear()}),e)},e.onSubmit=function(t){var n=this;if(t.preventDefault(),this.bankAccountName&&this.bankAccountNumber&&this.bankName){var e={rvn_bankacc_name:this.bankAccountName,rvn_bankacc_number:this.bankAccountNumber,rvn_bank_name:this.bankName,rvn_monney:this.totalAmount};k().request({method:"POST",url:k().forum.attribute("apiUrl")+"/pay-requests",body:{data:e}}).then((function(t){n.showAlert("success","Yêu cầu rút tiền đã được gửi!",5e3),n.onCancelConfirmed(),n.loading=!1})).catch((function(t){console.log(t),n.showAlert("error","Có lỗi xảy ra. Vui lòng thử lại!",5e3),n.loading=!1}))}},e.onCancelConfirmed=function(){this.bankAccountName="",this.bankAccountNumber="",this.bankName=""},e.className=function(){return"PayRequestTransactionModal"},n}(N()),j=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.loading=!0,this.moreResults=!1,this.transactionHistory=[],this.monneyTransaction={},this.user=this.attrs.params.user,this.loadResults()},e.getStatus=function(t,n,e,r,a,i){if(!n||0===n.length)return 1;var s=n.reduce((function(t,n){return t+parseFloat(n.rvn_amount)}),0)-e,o=this.user.id()===r;if(4===t)return 4;if(o){if(5===t)return 5===a?5:3===a?6:a;if(s>=0){if(3===a)return 3;if([1,2].includes(t))return 2;if(3===t)return 3}return 1}return 5===t?5===i?5:3===i?6:i:3===i?3:2},e.getStatusText=function(t){switch(t){case 3:return"Hoàn thành";case 4:return"Đã hủy";case 5:case 6:return"Đang khiếu nại";default:return"Đang xử lý"}},e.getStatusColor=function(t){switch(t){case 3:return"green";case 4:return"red";case 1:case 2:case 5:case 6:return"orange";default:return"gray"}},e.view=function(){var t=this;this.loading&&S().component({size:"large"});var n=this.monneyTransaction||{};return m("div",null,m("div",{style:"display: flex; justify-content: space-between;"},m("div",{style:"padding-bottom:10px; font-size: 24px; font-weight: bold;"},"Lịch sử giao dịch"),m("button",{class:"btn-withdraw",onclick:function(){k().modal.show(L)}},"Rút Tiền")),m("div",{class:"sideNavContainer"},m("div",{class:"container"},m("div",{class:"row"},m("div",{class:"col-12 col-md-6 col-lg-3"},m("div",{class:"card"},m("div",{class:"card-title"},"Đã chuyển"),m("div",{class:"card-value"},this.formatCurrency(n.total_monney_bank)))),m("div",{class:"col-12 col-md-6 col-lg-3"},m("div",{class:"card"},m("div",{class:"card-title"},"Hoàn thành job"),m("div",{class:"card-value"},this.formatCurrency(n.total_to_pay)))),m("div",{class:"col-12 col-md-6 col-lg-3"},m("div",{class:"card"},m("div",{class:"card-title"},"Đã hoàn trả"),m("div",{class:"card-value"},this.formatCurrency(0)))),m("div",{class:"col-12 col-md-6 col-lg-3"},m("div",{class:"card"},m("div",{class:"card-title"},"Được rút"),m("div",{class:"card-value"},this.formatCurrency(n.total_to_receive))))),m("table",{class:"rvn__table"},m("thead",{class:"rvn__thead"},m("tr",{class:"rvn__tr"},m("th",{class:"rvn__th"},"STT"),m("th",{class:"rvn__th"},"Tên đồ án"),m("th",{class:"rvn__th"},"Tên thợ"),m("th",{class:"rvn__th"},"Tiền thuê"),m("th",{class:"rvn__th"},"Phí"),m("th",{class:"rvn__th"},"Người trả phí"),m("th",{class:"rvn__th"},"Tổng tiền"),m("th",{class:"rvn__th"},"Trạng thái"),m("th",{class:"rvn__th"},"Ngày tạo"),m("th",{class:"rvn__th",style:"width:100px;"},"Chi tiết"))),m("tbody",{class:"rvn__tbody"},this.transactionHistory.map((function(n,e){var r=t.showPrice(t.user.id,n.attributes.creator.id,n.attributes.rvn_payer_id,n.attributes.rvn_amount,n.attributes.rvn_fee),a=t.getStatus(n.attributes.rvn_status,n.attributes.banks,r,n.attributes.creator.id,n.attributes.sender_last_status,n.attributes.receiver_last_status);return m("tr",{class:"rvn__tr",key:n.id,"data-id":n.id},m("td",{class:"rvn__td"},e+1),m("td",{class:"rvn__td"},n.attributes.creator.username+"__"+n.attributes.receiver.username),m("td",{class:"rvn__td"},n.attributes.receiver.username),m("td",{class:"rvn__td"},t.formatCurrency(n.attributes.rvn_amount)),m("td",{class:"rvn__td"},100*n.attributes.rvn_fee,"%"),m("td",{class:"rvn__td"},n.attributes.rvn_payer_id==n.attributes.rvn_receiver_id?n.attributes.receiver.username:n.attributes.creator.username),m("td",{class:"rvn__td"},t.formatCurrency(n.attributes.rvn_amount+n.attributes.rvn_amount*n.attributes.rvn_fee)),m("td",{class:"rvn__td",style:{color:t.getStatusColor(a)}},t.getStatusText(a)),m("td",{class:"rvn__td"},n.attributes.created_at),m("td.rvn__td",m(O(),{className:"User-controls",buttonClassName:"Button Button--icon Button--flat",menuClassName:"Dropdown-menu--right",icon:"fas fa-ellipsis-h"},[m("button.Button.UserList-detailBtn",{title:"Xem chi tiết",onclick:function(){return k().modal.show(H,{transId:n.id,userId:t.user.id()})}},["Xem chi tiết"]),2==a||5==a?m("button.Button.UserList-confirmBtn",{title:"Hoàn thành",onclick:function(){return k().modal.show(M,{transId:n.id,userId:t.user.id(),status:3,status_old:n.attributes.creator.id==t.user.id()?n.attributes.sender_last_status:n.attributes.receiver_last_status,onCancelConfirmed:function(){t.transactionHistory=[],t.loadResults()}})}},["Hoàn thành"]):"",1==a||2==a||5==a?m("button.Button.UserList-cancelBtn",{title:"Hủy",onclick:function(){return k().modal.show(M,{transId:n.id,userId:t.user.id(),status:4,status_old:n.attributes.creator.id==t.user.id()?n.attributes.sender_last_status:n.attributes.receiver_last_status,onCancelConfirmed:function(){t.transactionHistory=[],t.loadResults()}})}},["Hủy"]):"",2==a||3==a&&1!=a?m("button.Button.UserList-complaintsBtn",{title:"Khiếu nại",onclick:function(){return k().modal.show(M,{transId:n.id,userId:t.user.id(),status:5,status_old:n.attributes.creator.id==t.user.id()?n.attributes.sender_last_status:n.attributes.receiver_last_status,onCancelConfirmed:function(){t.transactionHistory=[],t.loadResults()}})}},["Khiếu nại"]):""])))})))))))},e.loadMore=function(){this.loading=!0,this.loadResults(this.transactionHistory.length)},e.showPrice=function(t,n,e,r,a){return n==t&&t==e?a*r:n==t&&t!=e?0:n!=t&&t==e?r+a*r:r},e.caculator=function(t,n,e){return void 0===e&&(e=!1),e?this.formatCurrency(t+n*t):this.formatCurrency(n*t)},e.formatCurrency=function(t){return t||(t=0),(+t).toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0,maximumFractionDigits:0})},e.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.transactionHistory,t.payload.data),this.loading=!1,m.redraw(),t},e.parseMonneyResults=function(t){return this.monneyTransaction=B({},t.data.attributes),this.loading=!1,m.redraw(),t},e.hasMoreResults=function(){return this.moreResults},e.loadResults=function(t){return void 0===t&&(t=0),k().request({method:"GET",url:k().forum.attribute("apiUrl")+"/get-all-transactions"}).then(this.parseMonneyResults.bind(this)).catch((function(){})),k().store.find("transactions",{filter:{user:this.user.id()},page:{offset:t}}).catch((function(){})).then(this.parseResults.bind(this))},n}(A()),q=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.loadUser(m.route.param("username"))},e.content=function(){return m("div",{className:"TransferHistoryPage"},j.component({params:{user:this.user}}))},n}(R());const z=flarum.core.compat["components/Notification"];var G=t.n(z);flarum.core.compat["common/helpers/username"];var V=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var e=n.prototype;return e.icon=function(){return"fas fa-exchange-alt"},e.href=function(){return r().route.transaction(this.attrs.notification.subject())},e.content=function(){return r().translator.trans("retechvn-mediated-transaction.forum.notifications.transaction_created_text",{user:this.attrs.notification.fromUser(),transaction:this.attrs.notification.subject()})},n}(G());const X=flarum.core.compat["components/NotificationGrid"];var K=t.n(X);r().initializers.add("retechvn/mediated-transaction",(function(){r().routes.transactionPage={path:"/giao-dich-trung-gian",component:T},r().routes["user.transactionHistoryPage"]={path:"/u/:username/lich-su-giao-dich",component:q},r().notificationComponents.transactionCreated=V,(0,s.extend)(K().prototype,"notificationTypes",(function(t){t.add("transactionCreated",{name:"transactionCreated",icon:"fas fa-exchange-alt",label:r().translator.trans("retechvn-mediated-transaction.forum.notifications.transaction_created_label")})})),(0,s.extend)(c().prototype,"navItems",(function(t){r().session&&r().session.user&&r().session.user&&t.add("transactionPage",m(i(),{href:r().route("transactionPage"),icon:"fas fa-magic"},"Giao dịch trung gian"),100)})),(0,s.extend)(I().prototype,"items",(function(t){r().session&&r().session.user&&r().session.user})),(0,s.extend)(R().prototype,"navItems",(function(t,n){r().session&&r().session.user&&r().session.user.id()==this.user.id()&&t.add("transactionMoney",i().component({href:r().route("user.transactionHistoryPage",{username:this.user.username()}),icon:"fas fa-money-bill"},["Lịch sử giao dịch"]),10)}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map