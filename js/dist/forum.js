/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,n,r)=>{var e=r(735).default;function a(){"use strict";t.exports=a=function(){return r},t.exports.__esModule=!0,t.exports.default=t.exports;var n,r={},o=Object.prototype,i=o.hasOwnProperty,s=Object.defineProperty||function(t,n,r){t[n]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",h=c.toStringTag||"@@toStringTag";function d(t,n,r){return Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{d({},"")}catch(n){d=function(t,n,r){return t[n]=r}}function m(t,n,r,e){var a=n&&n.prototype instanceof b?n:b,o=Object.create(a.prototype),i=new R(e||[]);return s(o,"_invoke",{value:F(t,r,i)}),o}function v(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=m;var f="suspendedStart",p="suspendedYield",_="executing",y="completed",g={};function b(){}function w(){}function k(){}var x={};d(x,u,(function(){return this}));var N=Object.getPrototypeOf,C=N&&N(N(S([])));C&&C!==o&&i.call(C,u)&&(x=C);var T=k.prototype=b.prototype=Object.create(x);function L(t){["next","throw","return"].forEach((function(n){d(t,n,(function(t){return this._invoke(n,t)}))}))}function I(t,n){function r(a,o,s,c){var u=v(t[a],t,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==e(h)&&i.call(h,"__await")?n.resolve(h.__await).then((function(t){r("next",t,s,c)}),(function(t){r("throw",t,s,c)})):n.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return r("throw",t,s,c)}))}c(u.arg)}var a;s(this,"_invoke",{value:function(t,e){function o(){return new n((function(n,a){r(t,e,n,a)}))}return a=a?a.then(o,o):o()}})}function F(t,r,e){var a=f;return function(o,i){if(a===_)throw Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:n,done:!0}}for(e.method=o,e.arg=i;;){var s=e.delegate;if(s){var c=B(s,e);if(c){if(c===g)continue;return c}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(a===f)throw a=y,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);a=_;var u=v(t,r,e);if("normal"===u.type){if(a=e.done?y:p,u.arg===g)continue;return{value:u.arg,done:e.done}}"throw"===u.type&&(a=y,e.method="throw",e.arg=u.arg)}}}function B(t,r){var e=r.method,a=t.iterator[e];if(a===n)return r.delegate=null,"throw"===e&&t.iterator.return&&(r.method="return",r.arg=n,B(t,r),"throw"===r.method)||"return"!==e&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+e+"' method")),g;var o=v(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=n),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function O(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function P(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function S(t){if(t||""===t){var r=t[u];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(i.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=n,r.done=!0,r};return o.next=o}}throw new TypeError(e(t)+" is not iterable")}return w.prototype=k,s(T,"constructor",{value:k,configurable:!0}),s(k,"constructor",{value:w,configurable:!0}),w.displayName=d(k,h,"GeneratorFunction"),r.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===w||"GeneratorFunction"===(n.displayName||n.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,k):(t.__proto__=k,d(t,h,"GeneratorFunction")),t.prototype=Object.create(T),t},r.awrap=function(t){return{__await:t}},L(I.prototype),d(I.prototype,l,(function(){return this})),r.AsyncIterator=I,r.async=function(t,n,e,a,o){void 0===o&&(o=Promise);var i=new I(m(t,n,e,a),o);return r.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(T),d(T,h,"Generator"),d(T,u,(function(){return this})),d(T,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var n=Object(t),r=[];for(var e in n)r.push(e);return r.reverse(),function t(){for(;r.length;){var e=r.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},r.values=S,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function e(e,a){return s.type="throw",s.arg=t,r.next=e,a&&(r.method="next",r.arg=n),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&i.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var a=e;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=n&&n<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=n,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),g},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),g}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var a=e.arg;P(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:S(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=n),g}},r}t.exports=a,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function n(r){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,n(r)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,n,r)=>{var e=r(24)();t.exports=e;try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return r.d(n,{a:n}),n},r.d=(t,n)=>{for(var e in n)r.o(n,e)&&!r.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},r.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),(()=>{"use strict";const t=flarum.core.compat["common/app"];r.n(t)().initializers.add("retechvn/mediated-transaction",(function(){console.log("[retechvn/mediated-transaction] Hello, forum and admin!")}));const n=flarum.core.compat["forum/app"];var e=r.n(n);const a=flarum.core.compat["components/LinkButton"];var o=r.n(a);const i=flarum.core.compat["common/extend"],s=flarum.core.compat["components/IndexPage"];var c=r.n(s);function u(t,n){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},u(t,n)}function l(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,u(t,n)}const h=flarum.core.compat["common/components/Page"];var d=r.n(h);const v=flarum.core.compat["helpers/listItems"];var f=r.n(v);const p=flarum.core.compat["components/Button"];var _=r.n(p);const y=flarum.core.compat["common/components/Alert"];var g=r.n(y);const b=flarum.core.compat["components/Modal"];var w=r.n(b);const k=flarum.core.compat.app;var x=r.n(k),N=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n)},r.title=function(){return"Thanh Toán Giao Dịch"},r.content=function(){return m(".Modal-body .row",[m(".Form-group",{style:"width: 100%; text-align: center;"},[m("a",{href:"https://me-qr.com",style:"cursor:pointer;display:block",border:"0"},[m("img",{src:"https://cdn2.me-qr.com/qr/129980334.png?v=1728835376",alt:"Create QR code for free"})])]),m(".Form-group ",{style:"width: 100%;"},[_().component({type:"submit",className:"Button Button--primary Button--block"},"Tiếp tục tạo giao dịch")])])},r.onsubmit=function(t){t.preventDefault(),this.attrs.onsubmit(!0),x().modal.close()},n}(w()),C=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.loading=!0,this.user_current=e().session.user,this.initializeData(),this.resultsUser=[],this.showDropdown=!1,this.handleClickOutside=this.handleClickOutside.bind(this)},r.initializeData=function(){this.data={rvn_creator_id:this.user_current.data.id,rvn_receiver_id:"",rvn_amount:0,rvn_fee:.1,rvn_payer_id:this.user_current.data.id,rvn_note:""},this.rvn_creator_name=e().session.user.username(),this.rvn_receiver_name="",this.rvn_service_fee=0,this.rvn_total_amount=0,this.rvn_receiver_name_search="",this.rvn_receiver_name_select=""},r.oncreate=function(n){t.prototype.oncreate.call(this,n),e().setTitle("Giao dịch trung gian"),e().setTitleCount(0),document.addEventListener("click",this.handleClickOutside)},r.onremove=function(){document.removeEventListener("click",this.handleClickOutside)},r.view=function(){return m(".IndexPage",[c().prototype.hero(),m(".container",[m(".sideNavContainer",[this.renderSidebar(),this.renderForm()])])])},r.renderSidebar=function(){return m("nav.IndexPage-nav.sideNav",m("ul",f()(c().prototype.sidebarItems().toArray())))},r.renderForm=function(){var t=this;return m(".IndexPage-results.sideNavOffset",[m("div.retechvn__text-center",m("h2","Giao dịch trung gian")),m(".Modal-body.rvn__body-form .row",[this.renderInput("Tên đồ án","Nhập tên đồ án",this.rvn_creator_name+(""!=this.rvn_receiver_name?"__"+this.rvn_receiver_name:""),!0),this.renderReceiverInput("Tên đối tác","Nhập tên đối tác cần tìm kiếm"),this.renderNumberInput("Tiền thuê",this.data.rvn_amount,this.handleRentChange.bind(this)),this.renderInput("Phí dịch vụ ("+100*this.data.rvn_fee+"%)","",this.rvn_service_fee,!0),this.renderRadioGroup("Người trả phí","Bạn trả phí","Đối tác trả phi"),this.renderInput("Tổng tiền bạn phải trả","",this.rvn_total_amount,!0),this.renderTextarea("Ghi chú",this.data.rvn_note,(function(n){return t.data.rvn_note=n.target.value})),this.renderCheckbox(),this.renderSubmitButton()])])},r.renderInput=function(t,n,r,e){return void 0===e&&(e=!1),m(".Form-group.col.col-md-6",[m("label",t),m("input.FormControl",{value:r,disabled:e,placeholder:n})])},r.renderReceiverInput=function(t,n){var r=this;return m(".Form-group.position-relative.col.col-md-6",[m("label",[t,m("span",{className:this.data.rvn_receiver_id?"rvn__text-green":"rvn__text-red"},this.data.rvn_receiver_id?" ("+this.rvn_receiver_name_select+")":" (Chưa chọn)")]),m("input.FormControl",{value:this.rvn_receiver_name_search,placeholder:n,onfocus:function(){return r.showDropdown=!0},onkeyup:function(t){r.rvn_receiver_name_search=t.target.value,setTimeout((function(){return r.search(t.target.value)}),100)}}),this.showDropdown&&this.renderDropdown()])},r.renderDropdown=function(){return m(".search-results",this.resultsUser.length?this.resultsUser.map(this.renderDropdownItem.bind(this)):m("div.no-results.rvn__mx2","Không có dữ liệu"))},r.renderDropdownItem=function(t){var n=this;return m("div.search-result-item",{onclick:function(){return n.selectReceiver(t)}},[t.avatarUrl()?m("img.Avatar.rvn__avatar",{src:t.avatarUrl(),alt:t.displayName()}):m("span.Avatar.rvn__avatar",{style:this.avatarStyle(t)},t.displayName().charAt(0).toUpperCase()),m("span.username","  "+t.displayName()+" ("+t.username()+")")])},r.renderNumberInput=function(t,n,r){return m(".Form-group.col.col-md-6",[m("label",t+" ("+this.formatCurrency(n)+")"),m("input[type=number].FormControl",{value:n,onchange:r})])},r.renderRadioGroup=function(t,n,r){return m(".Form-group.col.col-md-6",[m("label",t),m(".radio-group",[this.renderRadioOption(n,this.data.rvn_creator_id,this.rvn_creator_name,this.data.rvn_payer_id==this.data.rvn_creator_id),this.renderRadioOption(r,this.data.rvn_receiver_id,this.rvn_receiver_name,this.data.rvn_payer_id==this.data.rvn_receiver_id,!this.data.rvn_receiver_id)])])},r.renderRadioOption=function(t,n,r,e,a){var o=this;return void 0===a&&(a=!1),m("label",[m("input[type=radio]",{name:"fee_payer",value:n,checked:e,disabled:a,onchange:function(t){return o.handleFeePayerChange(t)}})," "+t+" ("+r+")"])},r.renderTextarea=function(t,n,r){return m(".Form-group.col.col-12.rvn_note",[m("label",t),m("textarea.FormControl",{value:n,onchange:r})])},r.renderCheckbox=function(){var t=this;return m(".Form-group.col",[m("label",[m("input[type=checkbox]",{checked:this.isChecked,onchange:function(n){return t.isChecked=n.target.checked}})," Đồng ý với điều khoản và điều kiện!"])])},r.renderSubmitButton=function(){var t=this;return m(".Form-group.col.col-12",[_().component({type:"button",className:"Button Button--primary Button--block",onclick:function(n){return t.onsubmit(n)}},"Tạo giao dịch")])},r.handleRentChange=function(t){this.data.rvn_amount=+t.target.value,this.calculateTotal()},r.handleFeePayerChange=function(t){this.data.rvn_payer_id=t.target.value,this.calculateTotal()},r.selectReceiver=function(t){this.rvn_receiver_name=t.username(),this.rvn_receiver_name_search="",this.rvn_receiver_name_select=t.displayName()+" ("+t.username()+")",this.data.rvn_receiver_id=t.data.id,this.showDropdown=!1},r.avatarStyle=function(t){return{"--avatar-bg":t.color(),"font-size":"20px"}},r.validateForm=function(){for(var t=this.data,n=0,r=[[!t.rvn_receiver_id,"Chưa chọn tên đối tác."],[t.rvn_amount<=0,"Tiền thuê phải lớn hơn 0."],[!t.rvn_fee,"Phí dịch vụ không hợp lệ."],[!t.rvn_payer_id,"Người trả phí chưa được chọn."],[!this.isChecked,"Bạn phải đồng ý với điều khoản và điều kiện."]];n<r.length;n++){var e=r[n],a=e[0],o=e[1];if(a)return this.showAlert("error",o,5e3),!1}return!0},r.formatCurrency=function(t){return(+t).toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0,maximumFractionDigits:0})},r.calculateTotal=function(){var t=+this.data.rvn_amount||0,n=.1*t;this.rvn_service_fee=this.formatCurrency(n),this.rvn_total_amount=this.formatCurrency(this.data.rvn_payer_id==this.data.rvn_creator_id?t+n:t)},r.search=function(t){var n=this;t.trim()?e().store.find("users",{filter:{q:t}}).then((function(t){n.resultsUser=t.filter((function(t){return t.data.id!=n.user_current.id()})),n.showDropdown=!0})):(this.resultsUser=[],this.showDropdown=!1)},r.handleClickOutside=function(t){t.target.closest(".FormControl")||t.target.closest(".search-results")||(this.showDropdown=!1,m.redraw())},r.showAlert=function(t,n,r){void 0===t&&(t="success"),void 0===n&&(n=""),void 0===r&&(r=5e3),e().alerts.show(g(),{type:t},n),setTimeout((function(){e().alerts.clear()}),r)},r.onsubmit=function(t){var n=this;t.preventDefault(),this.loading=!0;var r={rvn_creator_id:Number(this.data.rvn_creator_id),rvn_receiver_id:Number(this.data.rvn_receiver_id),rvn_amount:Number(this.data.rvn_amount),rvn_fee:this.data.rvn_fee,rvn_payer_id:Number(this.data.rvn_payer_id),rvn_note:this.data.rvn_note};e().modal.show(N,{onsubmit:function(t){e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/transactions",body:{data:r}}).then((function(t){n.showAlert("success","Tạo giao dịch thành công!",5e3),n.initializeData(),n.loading=!1})).catch((function(t){console.log(t),n.showAlert("error","Có lỗi xảy ra. Vui lòng thử lại!",5e3),n.loading=!1}))}})},n}(d());const T=flarum.core.compat["forum/components/HeaderSecondary"];var L=r.n(T);const I=flarum.core.compat["components/UserPage"];var F=r.n(I);function B(){return B=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var e in r)({}).hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t},B.apply(null,arguments)}const O=flarum.core.compat.Component;var P=r.n(O);const R=flarum.core.compat["components/LoadingIndicator"];var S=r.n(R);const A=flarum.core.compat["common/components/Dropdown"];var D=r.n(A),E=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.transId=this.attrs.transId,this.currentUserId=this.attrs.userId,this.loading=!0,this.moreResults=!1,this.tranlogs=[],this.loadData(this.transId)},r.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.tranlogs,t.payload.data),this.loading=!1,m.redraw(),t},r.loadData=function(t,n){void 0===n&&(n=0),x().store.find("transaction-logs",{filter:{transactionId:t},page:{offset:n}}).catch((function(){})).then(this.parseResults.bind(this))},r.title=function(){return"Chi tiết giao dịch"},r.content=function(){var t=this;return this.loading?m("div",{className:"Modal-body"},S().component({size:"large"})):m("div",{className:"Modal-body sideNavContainer"},m("table",{className:"TransactionLogsTable rvn__table"},m("thead",{class:"rvn__thead"},m("tr",{class:"rvn__tr"},m("th",{class:"rvn__th"},"STT"),m("th",{class:"rvn__th"},"Trạng thái"),m("th",{class:"rvn__th"},"Lý do"),m("th",{class:"rvn__th"},"Ngày cập nhật"))),m("tbody",{class:"rvn__tbody"},this.tranlogs.length?this.tranlogs.map((function(n,r){return m("tr",{key:n.id,class:"rvn__tr"},m("td",{class:"rvn__th"},r+1),m("td",{class:"rvn__th"},t.showText(t.currentUserId,n.attributes.creator,n.attributes.rvn_status,n.attributes.transaction)),m("td",{class:"rvn__th"},n.attributes.rvn_reason||"N/A"),m("td",{class:"rvn__th"},n.attributes.updated_at))})):m("tr",null,m("td",{class:"rvn__th",colSpan:"6"},"Không có dữ liệu")))))},r.showText=function(t,n,r,e){var a="";return 1==r&&(a="["+n.username+"] đã tạo giao dịch"),2==r&&(a="["+n.username+"] đã thanh toán giao dịch"),3==r&&(a="["+n.username+"] đã hoàn thành giao dịch"),4==r&&(a="["+n.username+"] đã hủy giao dịch"),5==r&&(a="["+n.username+"] đã khiếu nại giao dịch"),a},r.onsubmit=function(t){t.preventDefault()},r.className=function(){return"DetailTransactionModal"},n}(w()),j=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.transId=this.attrs.transId,this.currentUserId=this.attrs.userId,this.reason="",this.loading=!1,this.status=this.attrs.status,this.status_old=this.attrs.status_old,this.onCancelConfirmed=this.attrs.onCancelConfirmed||function(){}},r.titleStatus=function(t){switch(t){case 3:return"Xác nhận hoàn thành giao dịch";case 4:return"Xác nhận hủy giao dịch";case 5:return"Xác nhận khiếu nại giao dịch";default:this.hide()}},r.title=function(){return this.titleStatus(this.status)},r.content=function(){var t=this;return m("div",{className:"Modal-body"},3!==this.status?m("div",{className:"Form-group"},m("label",null,"Lý do"),m("input",{className:"FormControl",type:"text",placeholder:"Nhập lý do",value:this.reason,oninput:function(n){t.reason=n.target.value}})):"",m("div",{className:"Form-group"},m(_(),{className:"Button Button--primary",type:"submit",loading:this.loading},"Xác nhận"),m(_(),{className:"Button Button--secondary",onclick:function(){t.onCancelConfirmed(),t.hide()}},"Hủy bỏ")))},r.onsubmit=function(t){var n=this;t.preventDefault(),this.loading=!0;var r={transId:Number(this.transId),userId:Number(this.currentUserId),reason:this.reason,status:this.status,status_old:this.status_old};x().request({method:"POST",url:x().forum.attribute("apiUrl")+"/transaction-logs",body:{data:r}}).then((function(t){n.loading=!1,n.onCancelConfirmed(),n.hide(),x().alerts.show({type:"success"},"Đã cập nhật.")})).catch((function(t){n.loading=!1,x().alerts.show({type:"error"},"Đã xảy ra lỗi. Vui lòng thử lại.")}))},r.className=function(){return"CancelTransactionModal"},n}(w());function U(t,n,r,e,a,o,i){try{var s=t[o](i),c=s.value}catch(t){return void r(t)}s.done?n(c):Promise.resolve(c).then(e,a)}var H=r(183),M=r.n(H),G=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.bankAccountName="",this.bankAccountNumber="",this.bankName="",this.totalAmount=5e5,this.bankList=[],this.loadingBanks=!1,this.getBankName()},r.getBankName=function(){var t,n=(t=M().mark((function t(){var n;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadingBanks=!0,t.prev=1,t.next=4,x().request({method:"GET",url:"https://api.vietqr.io/v2/banks"});case 4:n=t.sent,console.log(n),this.bankList=n.data.map((function(t){return{value:t.code,label:t.name}})),console.log(this.bankList),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),console.error("Error fetching bank list:",t.t0),this.showAlert("error","Không thể tải danh sách ngân hàng. Vui lòng thử lại sau.",5e3);case 14:return t.prev=14,this.loadingBanks=!1,m.redraw(),t.finish(14);case 18:case"end":return t.stop()}}),t,this,[[1,10,14,18]])})),function(){var n=this,r=arguments;return new Promise((function(e,a){var o=t.apply(n,r);function i(t){U(o,e,a,i,s,"next",t)}function s(t){U(o,e,a,i,s,"throw",t)}i(void 0)}))});return function(){return n.apply(this,arguments)}}(),r.title=function(){return"Yêu cầu rút tiền"},r.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form-group"},m("label",null,"Tổng số tiền có thể rút"),m("input",{className:"FormControl",type:"text",value:this.totalAmount,disabled:!0})),m("div",{className:"Form-group"},m("label",null,"Tên ngân hàng"),this.loadingBanks?m("div",null,"Đang tải danh sách ngân hàng..."):m("select",{className:"FormControl",value:this.bankName,onchange:function(n){t.bankName=n.target.value}},m("option",{value:"",disabled:!0},"Chọn ngân hàng"),this.bankList.map((function(t){return m("option",{key:t.value,value:t.value},t.label)})))),m("div",{className:"Form-group"},m("label",null,"Tên tài khoản"),m("input",{className:"FormControl",type:"text",placeholder:"Nhập tên tài khoản ngân hàng",value:this.bankAccountName,oninput:function(n){t.bankAccountName=n.target.value}})),m("div",{className:"Form-group"},m("label",null,"Số tài khoản"),m("input",{className:"FormControl",type:"text",placeholder:"Nhập số tài khoản ngân hàng",value:this.bankAccountNumber,oninput:function(n){t.bankAccountNumber=n.target.value}})),m("div",{className:"Form-group"},m(_(),{className:"Button Button--primary",type:"submit",loading:this.loading},"Xác nhận"),m(_(),{className:"Button Button--secondary",onclick:function(){t.onCancelConfirmed(),t.hide()}},"Hủy bỏ")))},r.showAlert=function(t,n,r){void 0===t&&(t="success"),void 0===n&&(n=""),void 0===r&&(r=5e3),x().alerts.show(g(),{type:t},n),setTimeout((function(){x().alerts.clear()}),r)},r.onsubmit=function(t){var n=this;if(t.preventDefault(),this.bankAccountName&&this.bankAccountNumber&&this.bankName&&this.totalAmount){var r={rvn_bankacc_name:this.bankAccountName,rvn_bankacc_number:this.bankAccountNumber,rvn_bank_name:this.bankName,rvn_monney:this.totalAmount};x().request({method:"POST",url:x().forum.attribute("apiUrl")+"/pay-requests",body:{data:r}}).then((function(t){n.showAlert("success","Yêu cầu rút tiền đã được gửi!",5e3),n.onCancelConfirmed(),n.loading=!1,x().modal.close()})).catch((function(t){console.log(t),n.showAlert("error","Có lỗi xảy ra. Vui lòng thử lại!",5e3),n.loading=!1}))}else this.showAlert("error","Thiếu thông tin!",2e3)},r.onCancelConfirmed=function(){this.bankAccountName="",this.bankAccountNumber="",this.bankName=""},r.className=function(){return"PayRequestTransactionModal"},n}(w()),q=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.loading=!0,this.moreResults=!1,this.transactionHistory=[],this.monneyTransaction={},this.user=this.attrs.params.user,this.loadResults()},r.getStatus=function(t,n,r,e,a,o){if(!n||0===n.length)return 1;var i=n.reduce((function(t,n){return t+parseFloat(n.rvn_amount)}),0)-r,s=this.user.id()===e;if(4===t)return 4;if(s){if(5===t)return 5===a?5:3===a?6:a;if(i>=0){if(3===a)return 3;if([1,2].includes(t))return 2;if(3===t)return 3}return 1}return 5===t?5===o?5:3===o?6:o:3===o?3:2},r.getStatusText=function(t){switch(t){case 3:return"Hoàn thành";case 4:return"Đã hủy";case 5:case 6:return"Đang khiếu nại";default:return"Đang xử lý"}},r.getStatusColor=function(t){switch(t){case 3:return"green";case 4:return"red";case 1:case 2:case 5:case 6:return"orange";default:return"gray"}},r.view=function(){var t=this;this.loading&&S().component({size:"large"});var n=this.monneyTransaction||{};return m("div",null,m("div",{style:"display: flex; justify-content: space-between;"},m("div",{style:"padding-bottom:10px; font-size: 24px; font-weight: bold;"},"Lịch sử giao dịch"),m("button",{class:"btn-withdraw",onclick:function(){x().modal.show(G)}},"Rút Tiền")),m("div",{class:"sideNavContainer"},m("div",{class:"container"},m("div",{class:"row"},m("div",{class:"col-12 col-md-6 col-lg-3"},m("div",{class:"card"},m("div",{class:"card-title"},"Đã chuyển"),m("div",{class:"card-value"},this.formatCurrency(n.total_monney_bank)))),m("div",{class:"col-12 col-md-6 col-lg-3"},m("div",{class:"card"},m("div",{class:"card-title"},"Hoàn thành job"),m("div",{class:"card-value"},this.formatCurrency(n.total_to_pay)))),m("div",{class:"col-12 col-md-6 col-lg-3"},m("div",{class:"card"},m("div",{class:"card-title"},"Đã hoàn trả"),m("div",{class:"card-value"},this.formatCurrency(0)))),m("div",{class:"col-12 col-md-6 col-lg-3"},m("div",{class:"card"},m("div",{class:"card-title"},"Được rút"),m("div",{class:"card-value"},this.formatCurrency(n.total_to_receive))))),m("table",{class:"rvn__table"},m("thead",{class:"rvn__thead"},m("tr",{class:"rvn__tr"},m("th",{class:"rvn__th"},"STT"),m("th",{class:"rvn__th"},"Tên đồ án"),m("th",{class:"rvn__th"},"Tên thợ"),m("th",{class:"rvn__th"},"Tiền thuê"),m("th",{class:"rvn__th"},"Phí"),m("th",{class:"rvn__th"},"Người trả phí"),m("th",{class:"rvn__th"},"Tổng tiền"),m("th",{class:"rvn__th"},"Trạng thái"),m("th",{class:"rvn__th"},"Ngày tạo"),m("th",{class:"rvn__th",style:"width:100px;"},"Chi tiết"))),m("tbody",{class:"rvn__tbody"},this.transactionHistory.map((function(n,r){var e=t.showPrice(t.user.id,n.attributes.creator.id,n.attributes.rvn_payer_id,n.attributes.rvn_amount,n.attributes.rvn_fee),a=t.getStatus(n.attributes.rvn_status,n.attributes.banks,e,n.attributes.creator.id,n.attributes.sender_last_status,n.attributes.receiver_last_status);return m("tr",{class:"rvn__tr",key:n.id,"data-id":n.id},m("td",{class:"rvn__td"},r+1),m("td",{class:"rvn__td"},n.attributes.creator.username+"__"+n.attributes.receiver.username),m("td",{class:"rvn__td"},n.attributes.receiver.username),m("td",{class:"rvn__td"},t.formatCurrency(n.attributes.rvn_amount)),m("td",{class:"rvn__td"},100*n.attributes.rvn_fee,"%"),m("td",{class:"rvn__td"},n.attributes.rvn_payer_id==n.attributes.rvn_receiver_id?n.attributes.receiver.username:n.attributes.creator.username),m("td",{class:"rvn__td"},t.formatCurrency(n.attributes.rvn_amount+n.attributes.rvn_amount*n.attributes.rvn_fee)),m("td",{class:"rvn__td",style:{color:t.getStatusColor(a)}},t.getStatusText(a)),m("td",{class:"rvn__td"},n.attributes.created_at),m("td.rvn__td",m(D(),{className:"User-controls",buttonClassName:"Button Button--icon Button--flat",menuClassName:"Dropdown-menu--right",icon:"fas fa-ellipsis-h"},[m("button.Button.UserList-detailBtn",{title:"Xem chi tiết",onclick:function(){return x().modal.show(E,{transId:n.id,userId:t.user.id()})}},["Xem chi tiết"]),2==a||5==a?m("button.Button.UserList-confirmBtn",{title:"Hoàn thành",onclick:function(){return x().modal.show(j,{transId:n.id,userId:t.user.id(),status:3,status_old:n.attributes.creator.id==t.user.id()?n.attributes.sender_last_status:n.attributes.receiver_last_status,onCancelConfirmed:function(){t.transactionHistory=[],t.loadResults()}})}},["Hoàn thành"]):"",1==a||2==a||5==a?m("button.Button.UserList-cancelBtn",{title:"Hủy",onclick:function(){return x().modal.show(j,{transId:n.id,userId:t.user.id(),status:4,status_old:n.attributes.creator.id==t.user.id()?n.attributes.sender_last_status:n.attributes.receiver_last_status,onCancelConfirmed:function(){t.transactionHistory=[],t.loadResults()}})}},["Hủy"]):"",2==a||3==a&&1!=a?m("button.Button.UserList-complaintsBtn",{title:"Khiếu nại",onclick:function(){return x().modal.show(j,{transId:n.id,userId:t.user.id(),status:5,status_old:n.attributes.creator.id==t.user.id()?n.attributes.sender_last_status:n.attributes.receiver_last_status,onCancelConfirmed:function(){t.transactionHistory=[],t.loadResults()}})}},["Khiếu nại"]):""])))})))))))},r.loadMore=function(){this.loading=!0,this.loadResults(this.transactionHistory.length)},r.showPrice=function(t,n,r,e,a){return n==t&&t==r?a*e:n==t&&t!=r?0:n!=t&&t==r?e+a*e:e},r.caculator=function(t,n,r){return void 0===r&&(r=!1),r?this.formatCurrency(t+n*t):this.formatCurrency(n*t)},r.formatCurrency=function(t){return t||(t=0),(+t).toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0,maximumFractionDigits:0})},r.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.transactionHistory,t.payload.data),this.loading=!1,m.redraw(),t},r.parseMonneyResults=function(t){return this.monneyTransaction=B({},t.data.attributes),this.loading=!1,m.redraw(),t},r.hasMoreResults=function(){return this.moreResults},r.loadResults=function(t){return void 0===t&&(t=0),x().request({method:"GET",url:x().forum.attribute("apiUrl")+"/get-all-transactions"}).then(this.parseMonneyResults.bind(this)).catch((function(){})),x().store.find("transactions",{filter:{user:this.user.id()},page:{offset:t}}).catch((function(){})).then(this.parseResults.bind(this))},n}(P()),z=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var r=n.prototype;return r.oninit=function(n){t.prototype.oninit.call(this,n),this.loadUser(m.route.param("username"))},r.content=function(){return m("div",{className:"TransferHistoryPage"},q.component({params:{user:this.user}}))},n}(F());const V=flarum.core.compat["components/Notification"];var X=r.n(V);flarum.core.compat["common/helpers/username"];var K=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var r=n.prototype;return r.icon=function(){return"fas fa-exchange-alt"},r.href=function(){return e().route.transaction(this.attrs.notification.subject())},r.content=function(){return e().translator.trans("retechvn-mediated-transaction.forum.notifications.transaction_created_text",{user:this.attrs.notification.fromUser(),transaction:this.attrs.notification.subject()})},n}(X());const Y=flarum.core.compat["components/NotificationGrid"];var Q=r.n(Y);e().initializers.add("retechvn/mediated-transaction",(function(){e().routes.transactionPage={path:"/giao-dich-trung-gian",component:C},e().routes["user.transactionHistoryPage"]={path:"/u/:username/lich-su-giao-dich",component:z},e().notificationComponents.transactionCreated=K,(0,i.extend)(Q().prototype,"notificationTypes",(function(t){t.add("transactionCreated",{name:"transactionCreated",icon:"fas fa-exchange-alt",label:e().translator.trans("retechvn-mediated-transaction.forum.notifications.transaction_created_label")})})),(0,i.extend)(c().prototype,"navItems",(function(t){e().session&&e().session.user&&e().session.user&&t.add("transactionPage",m(o(),{href:e().route("transactionPage"),icon:"fas fa-magic"},"Giao dịch trung gian"),100)})),(0,i.extend)(L().prototype,"items",(function(t){e().session&&e().session.user&&e().session.user})),(0,i.extend)(F().prototype,"navItems",(function(t,n){e().session&&e().session.user&&e().session.user.id()==this.user.id()&&t.add("transactionMoney",o().component({href:e().route("user.transactionHistoryPage",{username:this.user.username()}),icon:"fas fa-money-bill"},["Lịch sử giao dịch"]),10)}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map